var http=require("http");var key="59936cbc7642729f6f519c130c530bdd";var baseUrl="api.uwaterloo.ca";function process(e,f){try{var b=e.indexOf(" ");var a;var d;if(b==-1){a=d=""}else{a=e.split(" ");d=b==-1?"":e.substr(b+1)}switch(a[1]){case"weather":if(a.length==2){getWeather(function(g){f(g)})}else{f(returnHelpString())}break;case"holiday":if(a.length==2){getNextHoliday(function(g){f(g)})}else{f(returnHelpString())}break;case"exam":if(a.length==4){getExamSchedule(a[2],a[3],function(g){f(g)})}else{f(returnHelpString())}break;case undefined:case"help":f("Address bot with <b>@uwbot</b> or <b>@bot</b> (command) (options) <br>           <b>UWBot commands:</b> <br>             <b>weather</b>: get the current weather in waterloo <br>             <b>exam</b> (subject) (course_num): Gets exam info for given subject <br>             <b>holiday</b>: Get the date of the next holiday! <br>             <b>disclaimer</b>: Prints a boring disclaimer <br>             <b>help</b>: print this help command <br>");break;case"disclaimer":f("All information from api.uwaterloo.ca, the author provides no guarentees to its correctness.");break;default:f(returnHelpString());break}}catch(c){f("Uh-oh! Something has gone wrong! Please try again later!")}}function returnHelpString(){return"Unrecognized command, please refer to '@bot help' for accepted commands."}function getNextHoliday(b){var a="/v2/events/holidays.json";sendReq(a,function(c){if(c.meta.status==200){var e;var d=new Date();for(index in c.data){if(new Date(c.data[index].date)>d){e=c.data[index];break}}if(typeof e!=="undefined"){b("The next holiday is "+e.name+" on "+e.date+". Yay!")}}else{b("Cannot find the next holiday, maybe there is none... :(")}})}function getCurrentTerm(b){var a="/v2/terms/list.json?key="+key;sendReq(a,function(c){if(c.meta.status==200){b(c.data.current_term)}})}function getExamSchedule(a,d,e){var c="/v2/courses/"+a+"/"+d+"/examschedule.json?key="+key;var b;sendReq(c,function(f){if(f.meta.status==200&&typeof f.data.course!=="undefined"){b="Exam Info for "+f.data.course+": <br>";for(section in f.data.sections){b+="Section: "+f.data.section.section+"<br>         Date: "+f.data.section.date+"<br>         Start Time: "+f.data.section.start_time+"<br>         End Time: "+f.data.section.end_time+"<br>         Location: "+f.data.section.location+"<br>         "}}else{b="Cannot find exam information for '"+a+d+"'! Exam schedule is not up or no exams for this course ;)"}e(b)})}function getWeather(c){var b="/v2/weather/current.json";var a;sendReq(b,function(d){if(d.meta.status==200){a="The current temperature in Waterloo is: "+d.data.temperature_current_c+" Celsius";c(a)}else{c("Cannot get weather info for Waterloo...")}})}function sendReq(b,d){var a={host:baseUrl,port:80,path:b,method:"GET",headers:{"Content-Type":"application/json"}};var c=http.get(a,function(e){var f=[];e.on("data",function(g){f.push(g)}).on("end",function(){var g=Buffer.concat(f);d(JSON.parse(g))})});c.on("error",function(f){console.log("ERROR: "+f.message)})}module.exports.process=process;